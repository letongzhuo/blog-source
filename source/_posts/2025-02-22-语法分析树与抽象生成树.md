---
title: 语法分析树与抽象生成树
date: 2025/02/22 20:01:11
author: lele
tags:
  - 编译原理
categories:
  - 编译原理
  - 语法分析
---
语法分析树（Parse Tree）和抽象语法树（Abstract Syntax Tree, AST）**不是同一个东西**，但它们密切相关，且都用于表示代码的结构。以下是详细解释和对比：

---

### **1. 语法分析树（Parse Tree）**
- **定义**：根据上下文无关文法（CFG）的规则，严格展开每一步推导过程生成的树状结构。
- **特点**：
  - **完全忠实于文法规则**：每个非终结符（如 `Expr`、`Statement`）和终结符（如 `+`、`1`）都会出现在树中。
  - **包含所有细节**：包括括号、运算符优先级、冗余的语法节点。
  - **结构复杂**：树的高度和分支较多，可能包含对后续阶段无用的信息。

#### **示例：表达式 `1 + 2 * 3` 的语法分析树**
```
      Expr
      /|\
   Expr + Expr
    |     /|\
 Number  Expr * Expr
    |     |     |
    1  Number Number
           |     |
           2     3
```
- 每个节点对应文法中的非终结符（如 `Expr`、`Number`）。
- 叶子节点是终结符（如 `1`、`+`、`2`、`*`、`3`）。

---

### **2. 抽象语法树（AST）**
- **定义**：对语法分析树的简化表示，只保留与程序逻辑相关的结构，忽略语法细节（如括号、冗余的非终结符）。
- **特点**：
  - **简化结构**：去除不必要的语法节点（如 `Expr`、`Number`），直接保留操作符和操作数。
  - **关注语义**：体现运算优先级、代码逻辑结构。
  - **便于后续处理**：用于语义分析、代码优化、代码生成等阶段。

#### **示例：表达式 `1 + 2 * 3` 的 AST**
```
      +
     / \
    1   *
       / \
      2   3
```
- 叶子节点是操作数（`1`、`2`、`3`）。
- 内部节点是操作符（`+`、`*`）。

---

### **3. 核心区别**
| **特性**         | **语法分析树**                     | **抽象语法树（AST）**               |
|------------------|-----------------------------------|-----------------------------------|
| **目的**         | 严格反映文法规则的推导过程          | 简化结构，聚焦程序逻辑              |
| **节点类型**     | 包含所有非终结符和终结符            | 仅保留关键操作符和操作数            |
| **结构复杂度**   | 复杂（节点多、层次深）              | 简洁（节点少、层次浅）              |
| **括号处理**     | 显式包含括号节点                    | 通过树结构隐式表达优先级              |
| **用途**         | 语法分析阶段验证代码结构            | 语义分析、优化、代码生成等后续阶段    |

---

### **4. 为什么需要 AST？**
语法分析树虽然完整，但包含太多冗余信息，AST 通过简化使其更适合后续处理：
1. **去除冗余**：例如，`Expr` 和 `Number` 节点在 AST 中不需要显式存在。
2. **隐式表达优先级**：通过树结构直接体现运算符优先级（如 `*` 比 `+` 更底层）。
3. **跨平台兼容**：AST 与具体文法无关，方便不同编译器前端生成统一的中间表示。
4. **优化友好**：简化后的结构更容易应用代码优化规则。

---

### **5. 实际例子对比**
#### **代码片段：`a = 1 + 2 * 3;`**
- **语法分析树**：
  ```
        Statement
          |
        Assignment
        /  |   \
    Identifier = Expr
       |        /|\
       a     Expr + Expr
               |     /|\
             Number Expr * Expr
               |     |     |
               1   Number Number
                     |     |
                     2     3
  ```
- **AST**：
  ```
      Assignment
       /    \
     a       +
           /   \
          1     *
              /   \
             2     3
  ```

---

### **6. 生成 AST 的过程**
1. **语法分析阶段**：先生成语法分析树。
2. **语义分析阶段**：遍历语法分析树，丢弃无关节点（如 `Expr`），合并关键操作符和操作数，生成 AST。

---

### **7. 总结**
- **语法分析树**是“原始结构”，严格遵循文法规则，用于验证语法正确性。
- **AST**是“精炼结构”，聚焦程序逻辑，是后续编译阶段（如优化、代码生成）的基础。
- **关键区别**：AST 省略了语法细节，更简洁、更语义化。
