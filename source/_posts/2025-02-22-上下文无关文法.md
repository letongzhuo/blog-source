---
title: 上下文无关文法
date: 2025/02/22 19:55:05
author: lele
tags:
  - 编译原理
categories:
  - 编译原理
  - 语法分析
---
## 上下文无关文法
---
**上下文无关文法（Context-Free Grammar, CFG）** 是描述编程语言语法结构的一种形式化工具，它通过一组规则定义“合法的句子”如何构成。它的核心特点是：**规则的左侧只有一个非终结符，且规则的生成不依赖上下文**。下面用具体例子解释：

---

### **1. 什么是上下文无关文法？**
- **核心作用**：定义语言的语法结构（例如：算术表达式、程序语句）。
- **组成**：
  - **终结符（Terminal Symbols）**：语言中的基本元素（如数字、运算符、关键字）。
  - **非终结符（Non-Terminal Symbols）**：表示语法结构的抽象符号（如“表达式”“语句”）。
  - **产生式（Production Rules）**：定义非终结符如何展开为终结符或其他非终结符。
  - **起始符号（Start Symbol）**：文法的起点（通常是“程序”或“表达式”）。

---

### **2. 例子：四则运算表达式**
假设我们要定义简单的算术表达式（如 `1 + 2 * 3`），可以用以下 CFG 描述：

```plaintext
Expr → Expr + Expr       // 加法
     | Expr - Expr       // 减法
     | Expr * Expr       // 乘法
     | Expr / Expr       // 除法
     | ( Expr )          // 括号
     | Number            // 数字

Number → 0 | 1 | 2 | ... | 9 | Number Digit  // 整数
Digit → 0 | 1 | 2 | ... | 9
```

#### **符号解释**：
- **终结符**：`+`, `-`, `*`, `/`, `(`, `)`, 数字 `0-9`。
- **非终结符**：`Expr`, `Number`, `Digit`。
- **起始符号**：`Expr`。

#### **如何生成表达式？**
通过不断应用产生式规则，可以生成合法的表达式。例如，生成 `1 + 2 * 3` 的过程如下：
1. `Expr → Expr + Expr`  
2. 左侧 `Expr` → `Number → 1`  
3. 右侧 `Expr` → `Expr * Expr`  
4. 左侧 `Expr` → `Number → 2`  
5. 右侧 `Expr` → `Number → 3`  

最终得到 `1 + 2 * 3`。

---

### **3. 为什么叫“上下文无关”？**
- **关键特性**：非终结符的展开**不依赖周围的符号**。  
  例如，规则 `Expr → Expr + Expr` 在任何情况下都适用，无论 `Expr` 左边或右边是什么内容。

#### **对比正则文法（正则表达式）**：
- 正则文法只能描述线性结构（如关键词、标识符），无法处理嵌套结构（如括号匹配）。
- **CFG 更强大**：可以描述递归和嵌套结构（如 `((1 + 2) * 3)`）。

---

### **4. 另一个例子：编程语言中的 if 语句**
假设我们要定义 `if` 语句的语法：
```plaintext
Statement → if ( Condition ) { Statements }  // if语句
          | OtherStatement                   // 其他语句

Condition → Expr == Expr    // 条件判断（例如 a == b）
          | Expr > Expr

Statements → Statement Statements  // 语句序列
           | ε                     // 空语句（不写任何内容）
```

#### **生成 if 语句的过程**：
1. `Statement → if ( Condition ) { Statements }`  
2. `Condition → Expr == Expr`  
3. 左侧 `Expr` → `Number → 1`  
4. 右侧 `Expr` → `Number → 2`  
5. `Statements → ε`（不写任何语句）  

最终生成：`if (1 == 2) { }`。

---

### **5. CFG 在编译器中的应用**
- **语法分析器（Parser）**：根据 CFG 检查代码结构是否合法，并生成抽象语法树（AST）。
- **工具支持**：Yacc、Bison、ANTLR 等工具可以直接读取 CFG 生成解析器代码。

#### **示例：ANTLR 的 CFG 定义**
```antlr
expr : expr '+' expr
     | expr '*' expr
     | '(' expr ')'
     | NUMBER;
```

---

### **6. 注意：CFG 的局限性**
- **无法描述所有语言特性**：例如变量是否声明（需要语义分析）。
- **歧义性**：某些文法可能生成同一句子的多种语法树（如 `1 + 2 * 3` 可以有两种解释）。  
  **解决方法**：通过定义运算符优先级和结合性消除歧义。

---

### **总结**
- **上下文无关文法**是定义编程语言语法的核心工具。
- **核心思想**：通过产生式规则描述符号的生成，不依赖上下文。
- **典型应用**：算术表达式、程序语句（if/for）、JSON/XML 结构。


