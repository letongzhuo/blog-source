---
title: DHCP流程疑问
date: 2025/01/28 13:29
author: lele
tags:
  - 外链
sticky: "-1"
mathjax: true
---
在 DHCP 协议中，**第二步提供 IP 地址是服务器的“提议”，而第三步客户机的请求是正式接受该提议并确认分配**。具体原因如下：

---

### 1. **防止多服务器冲突**
   - 当客户机发送 **DHCP Discover**（第一步）时，网络中可能有多个 DHCP 服务器响应，每个服务器都会发送 **DHCP Offer**（第二步）并提供一个 IP 地址。
   - 客户机需要选择其中一个 Offer（通常是最先到达的），并通过 **DHCP Request**（第三步）明确告知所有服务器它选择了哪个 IP 地址。这一步避免了多个服务器同时分配不同 IP 地址造成的冲突。

---

### 2. **确保地址有效性**
   - 服务器在第二步提供的 IP 地址是“临时预留”状态，并未正式分配。客户机通过 **DHCP Request** 正式请求该地址后，服务器会检查地址是否仍可用（例如未被其他设备占用），最终通过 **DHCP ACK**（第四步）确认分配。
   - 若服务器在第四步发现地址已不可用，会发送 **DHCP NAK** 拒绝请求，客户机需重新发起 Discover。

---

### 3. **租约机制的完整性**
   - DHCP 分配的 IP 地址具有租期（如 24 小时）。客户机在 Request 中会携带服务器标识符（Server Identifier），明确选择哪个服务器提供的地址。服务器收到 Request 后，会在 ACK 中记录租约开始时间、租期等信息，完成租约绑定。

---

### 4. **客户机状态的明确性**
   - 客户机在初始状态（无 IP 地址）下需要逐步确认配置：
     1. **Discover**：寻找可用服务器。
     2. **Offer**：接收服务器的提议。
     3. **Request**：确认使用特定服务器的提议。
     4. **ACK**：完成配置并正式获得 IP 地址。
   - 若跳过 Request 直接分配，可能导致客户机未完全准备好接受配置（例如未加载其他网络参数）。

---

### 总结
DHCP 协议通过 **“提议（Offer）- 请求（Request）- 确认（ACK）”** 的三步交互，确保 IP 地址分配的可靠性：  
- **第二步的 Offer** 是服务器的初步响应，仅表示“我提供这个地址”。  
- **第三步的 Request** 是客户机的正式选择，告知服务器“我要用这个地址”。  
- **第四步的 ACK** 是服务器的最终确认，完成地址分配。  

这种设计避免了多服务器竞争、地址冲突等问题，同时支持租约管理等复杂功能。
<br>
{% btn regular::返回::/posts/20250125131300::fa-solid fa-arrow-left %}